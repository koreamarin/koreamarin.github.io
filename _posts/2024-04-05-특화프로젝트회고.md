---
layout: post
title: 특화프로젝트에 대한 회고
description: 특화프로젝트를 마치며..
date: 2024-04-05 00:00:00 +0000
categories: retrospect # Develop, Life, DevOps, Conference, BackEnd, AI, Etc, retrospect
comments: true
type: hide # done, writing, hide
---

# 1. 프로젝트 개요

#### [나만의 동화책을 만들며 재미있게 영어 공부하는 "끼리끼리"]

아이들이 ChatGPT와 이야기를 주고받으며 스토리를 작성하고, 작성된 스토리는 AI가 적합한 이미지를 만들어주어 그림 동화책으로 만들어져 영어학습에 활용하는 서비스 입니다.
작성된 동화책은 영어로 번역하여 듣기/쓰기 영어 학습이 가능합니다.
또한, 나의 동화책을 남에게 보여줄 수 있으며, 다른 사람이 만든 동화책을 열람하고 소장할 수도 있고, 소장한 동화책 또한 영어 학습으로 활용할 수 있습니다.

# 2. 프로젝트 관련 링크

[🔗 UCC](https://www.youtube.com/watch?v=Jt_GDWPBpAs) [4~6초 찔끔 출현ㅎㅎ]  
[🔗 GitHub링크](https://github.com/koreamarin/kkirikkiri)  
[🔗 Mockup Page](https://www.figma.com/file/kMEacEeHDkMxz6z7cG7wH7/%EB%81%BC%EB%A6%AC%EB%81%BC%EB%A6%AC?type=design&node-id=0%3A1&mode=design&t=Jis4LdeesTKbje2i-1)

# 3. 기술/환경

#### **FE**

<img src="https://img.shields.io/badge/React-61DAFB?style=for-the-badge&logo=React&logoColor=white"> : SPA로 Document를 작성하기 위해서 React프레임워크를 사용하였습니다.
<br>
<img src="https://img.shields.io/badge/Zustand-FF9900?style=for-the-badge&logo=Zustand&logoColor=orange"> : Props을 여러번 상속하는 등의 복잡함을 줄이기 위해 상태관리 툴을 사용하였습니다.

---

#### **BE**

<img src="https://img.shields.io/badge/SpringBoot-6DB33F?style=for-the-badge&logo=SpringBoot&logoColor=white"> : springBoot가 초기세팅이 간단하고, WAS가 내장톰캣으로 구성되어 있어 배포가 용이하여 사용하게 되었습니다.  
![Spring Data Jpa](https://img.shields.io/badge/spring%20data%20jpa-green?style=for-the-badge&logoColor=white) : 테이블과 객체를 매핑하여 엔티티로 사용함으로서 객체지향적인 코드 사용으로 개발 생산성을 높이고, 용이한 유지보수를 위해 사용하였습니다.
<br>
<img src="https://img.shields.io/badge/fastapi-009688?style=for-the-badge&logo=fastapi&logoColor=white"> : AI모델이 Python 기반으로 동작하여 이미지를 생성기능을 제공해 주기 위해 간단한 Python기반 BE 프레임워크인 FastAPI를 사용하게 되었습니다.

---

#### **INFRA**

<img src="https://img.shields.io/badge/Docker-2496ED?style=for-the-badge&logo=Docker&logoColor=white"> : Push된 코드들을 Build 이미지로 만들어 DockerHub에 Push하여 버전 관리하기 위함과, 하나의 서버에서 BE/FE/DB들을 컨테이너로 격리하기 위해 사용하였습니다.
<br><img src="https://img.shields.io/badge/Jenkins-D24939?style=for-the-badge&logo=Jenkins&logoColor=white"> : CI/CD 기능을 구현하기 위해 사용하였습니다. 코드가 Push되면 WebHook Post요청이 들어오고, BE/FE가 각각 build되어 Docker image로 만들어지게끔 구성하였습니다.
<br>
<img src="https://img.shields.io/badge/nginx-009639?style=for-the-badge&logo=nginx&logoColor=white"> : FE코드 Build 후에 index.html과 각 static file을 호스팅하기위해 사용하였습니다. 또한, http로 접속 시에 암호화 통신이 적용된 https로 접속할 수 있도록 리버스 프록시를 사용하였습니다.
<br>
<img src="https://img.shields.io/badge/amazon_ec2-FF9900?style=for-the-badge&logo=amazonec2&logoColor=white"> : 리눅스환경에서 돌아가는 서버가 필요하였는데 On premise환경의 서버는 초기 비용이 많이들고 하드웨어 관리가 필요하므로, 클라우드 환경에서 가장 저렴하게 구할 수 있는 Amazon EC2 서버를 사용하였습니다.
<br>
<img src="https://img.shields.io/badge/amazon_s3-569A31?style=for-the-badge&logo=amazons3&logoColor=white"> : 이미지와 음원파일을 URL형태로 호스팅해주는 기능이 필요하여 Amazon S3를 사용하여 파일을 관리하였습니다.
<br>

---

#### **DB**

<img src="https://img.shields.io/badge/MariaDB-003545?style=for-the-badge&logo=MariaDB&logoColor=white">

---

#### **AI**

Stable Diffusion v2.1  
Dreambooth  
HuggingFace

---

# 4. 담당 구현 기능

##### 이번 프로젝트에서는 모든 포지션을 접할 수 있었으며, 핵심적인 역할을 한 부분은 서버구성 인프라와 CI/CD를 구성한 것입니다.

### 인프라 구조 설계 [주 담당]

<a href="/image/특화프로젝트CICD구성.png" target="_blank">🔗 인프라 구성도 클릭시 확대 <br><img src="/image/특화프로젝트CICD구성.png"/></a>

- AI, FrontEnd, BackEnd, DataBase가 돌아갈 수 있는 인프라 구조 구성
  <br>
- Docker를 이용하여 하나의 EC2내에서 FE, BE, DB를 격리하여 운영
  <br>
- 포트포워딩 적용 및 On Premise형태로 AI의 서버 운영
  <br>
- Nginx
  - Docker Container 내부의 Nginx는 Static File의 호스팅용으로 사용
  - EC2 내부의 Nginx는 Reverse Proxy용으로 사용
    <br>
- Domain Name 적용

  <br>

### CI/CD [주 담당]

<a href="/image/CICD_image기록%20구성도.png" target="_blank">🔗 Push된 코드 버전별 GitHubFlow와 Docker Hub <br><img src="/image/CICD_image기록%20구성도.png" width="55%"/></a>

- **Jenkins**를 이용하여 BE와 FE의 지속 통합/배포 환경 구성
  <br>
- GitLab에서 Jenkins로 WebHook 연결
  <br>
- BE와 FE용 PipeLine 작성
  <br>
- BE와 FE용 DockerFile 작성
  <br>

### BackEnd

- #### Bookshelves 도메인

  - Bookshelves 전체 조회 API 오류 수정 : 썸네일 imageURL와 Summery가 반환되지 않는 오류 수정
  - Bookshelves에 Story 추가 API 개발 : 다른 유저가 작성한 Story를 내 책장에 넣는 기능 추가
  - Bookshelevs에서 다른 유저의 Story 제거 API 개발
    <br><br>

- #### Library 도메인

  - Library 조회, 검색, 필터 기능 개발 : GET요청 방식으로 Library를 조회, QueryString으로 검색 및 필터기능 추가
    <br><br>

- #### Story 도메인

  - Story 상세 조회 API 오류 수정 : Summery와 create_date Column 추가 및 API에서 조회기능 추가
  - Story 전체 조회 API 오류 수정 : 작가명이 나오지 않는 오류 수정 및 각 Story의 첫번째 이미지 반환기능 추가
    <br>

### FrontEnd

- #### 회원가입 페이지

  - 아이디/닉네임 중복 체크 API 기능
  - 비밀번호 유효성 검사 기능
    <br><br>

- #### 마이 페이지

  - 초기 유저데이터 삽입
  - 비밀번호 유효성 검사 기능
  - 유저정보 변경 API 추가
  - 회원 탈퇴 API 추가
    <br><br>

- #### 책장 페이지
  - 내가 쓴 스토리북 / 다른 유저가 쓴 스토리북 책장에서 삭제 기능 추가
    <br><br>
- #### 학습 페이지

  - 학습 페이지 글자인식(MyScript API) 기능 추가
  - 글자인식 시 특수문자, 대소문자, 띄어쓰기 구분없이 인식하는 기능 추가
  - 스토리 페이지별 조회 API 기능 추가
  - 쓰기 학습 시에 필요한 단어 Random Block 기능 및 정답 처리 시 Block 제거 기능 개발
  - 학습과정기록 API 추가

# 5. 잘한점(Keep)

- AI와 FrontEnd, BackEnd가 돌아갈 수 있는 서버 구조를 설계하였습니다.
  <br><br>
- 하나의 EC2내에서 FE, BE, DB가 돌아가야 했기에 Docker Container로 격리하였습니다.
  <br><br>
- AI의 서버는 On Premise로 구성하였습니다. AI 모델의 Running을 위해 Cuda라는 프로그램 설치가 필요한데, 리눅스환경에 Cuda를 설치함에 어려움이 있었고, 개발 시간이 많지않아 개인컴퓨터 Windows OS에 모델을 Running시킨 후 포트포워딩하여 On Premise환경으로 운영하였습니다.
  <br><br>
- NginX를 2가지 방식으로 사용하였는데, Docker Container 내부의 Nginx는 Static File의 호스팅용으로 사용하였고, EC2 내부의 Nginx는 Reverse Proxy용으로 사용하였습니다.
  <br><br>
- 가비아에서 Domain Name을 구매하고 가비아에서 제공하는 Name Server에 EC2 IP를 등록하여 Domain Name으로 접근할 수 있도록 하였습니다. EC2의 IP에 직접 접근할 수 없도록하여 보안성 향상에 도움이 되기도 하였고, 의미없는 숫자로된 IP로 접근하는 것보다 Domain Name을 사용하면 사용자들이 쉽게 기억할 수 있기에 Domain Name을 사용하였습니다.

---

- 백, 프론트의 빌드과정과 배포과정이 살짝씩 다른데, SpringBoot코드는 build를 한 후, jar파일을 가지고 있는 이미지로 만들었다.  
  프론트코드는 Jenkins의 Node.js 플러그인이 고장나 있어서 어쩔 수 없이 Docker Image에서 node.js를 base image로 한 후,  
  프론트 코드를 빌드 하고, 이미지 내에 Nginx를 설치하여 Nginx로 index.html을 호스팅하는 방식을 사용하였다.
  <br><br>
- BackEnd : 많은 백엔드 코드가 작성되어 있어서 하나의 도메인만 개발할 수 있었다. 도서관 도메인을 개발하였다.
  <br><br>
- FrontEnd : FrontEnd의 규모가 컷었던지, 구현해야할 많은 기능들이 남아 있었다. 미구현된 API 연결, 학습페이지 기능 개발 외 기타 여러 버그 사항 수정
  <br><br>
- 손글씨인식 API : MyScript라는 API를 사용하여 글자인식을 하는 기능을 찾고, 프론트 팀원들이 쉽게 사용할 수 있도록 팀 페이지에 기록해 두었다

---

- 서버 인프라 구성 : 첫 인프라 구성이었고, 인프라에 대해 공부하며 프론트와 백엔드의 배포과정에 대해 이해할 수 있었다. 응답속도를 조금이라도 빠르게 하기 위해서 DB 컨테이너와 BackEnd 컨테이너간의 통신 경로 대해 고민할 수 있었다.  
  또한 AI 모델이 적용된 FastAPI를 리눅스 환경에 배포하기가 까다로워 빠르게 on Premise 환경으로 배포하는 과정에서 포트포워딩에 대해 다시 한번 학습할 수 있었다.
  <br><br>
- CI/CD : Jenkins와 Docker 이미지, 컨테이너에 대해 깊게 경험할 수 있었다. Jenkins가 Webhook이 발동하여 코드를 pull하면, 코드를 빌드하고, 빌드 파일이 나오면 docker image로 만들어서 docker Hub에 Push하였다. 이렇게 하면 각 개발된 코드를 Push할 때마다 당시의 코드들이 docker hub에 이미지로 남아 버전별로 이미지를 관리할 수 있게 된다. 추후에 잘못된 코드가 실행되어 이전 코드를 배포하기를 원할 시 이전 버전의 docker image를 running시키면 되므로 버전관리를 쉽게 할 수 있게된다.
  <br><br>
- 프론트 개발 진행 : 인프라구성, CI/CD와 백엔드가 끝나고 개발 마지막주에 프론트에 투입되었는데 예상치 못하게 많은 기능들을 구현하였다. 디자인은 많이 되어있었는데, 잔버그가 많았고, 미구현된 기능도 많았었지만 다 같이 여러 밤을 새는 등 서로 의지하고 강하게 개발하여 개발을 끝낼 수 있었다.
  <br><br>
- 원할한 소통 : 팀원들간의 소통이 좋았다. 서로 어려운점이나 물어봐야할 것들이 있으면 서슴없이 말하는 분위기가 되게 좋았다.
  <br><br>
- Git Flow : 이번 팀은 git Flow가 되게 잘 나왔다. master Branch와 Be_develop 브랜치, FE_develop브랜치, AI_develop 브랜치 총 3개의 개발용 Branch를 만들었으며, 기능구현을 할 때에는 각 Branch에서 분기하여 Feature 브랜치를 따로 만들어 기능개발을 한 후, 푸쉬하는 방식으로 개발하였다.
  충돌도 많았지만, 큰 문제 없이 해결되었고, 협업이 잘 되었던 경험으로 남았다.
  <br><br>
- 도메인을 구입하여 Name Server에 적용 : 가비아에서 도메인을 구입하여 Name Server에 적용하는 경험을 하였다. 어렵지는 않았지만, 전세계의 Name Server에 도메인내역이 업데이트되는 시간을 느끼며 이론으로 배운 것을 경험하여 신기하고 재밌는 경험이였다.

# 6. 개선할 점, 시도해볼 점(Try)

- 무중단 배포 : 다음 CI/CD를 경험하게 된다면 쿠버네티스 또는 Nginx를 이용하여 무중단 배포를 서비스하고 싶다.
- 여러대의 EC2 운용 : 이번 프로젝트에서는 한대의 EC2에서 컨테이너로 환경을 독립적으로 만들어 백과 프론트를 구성하였다. 다음번에는 EC2를 여러대 사용하여 리버스프록시 서버, 백엔드 서버, 프론트 서버, DB용 서버 등으로 나눠 실제 환경과 조금이라도 유사한 환경을 구축하고 싶다.
- dockerCompose 사용 : dockerCompose를 이용하여 서버증축을 위한 코드 작성이나, 여러대의 컨테이너 관리, 여러개의 이미지 빌드 등, 여러개의 컨테이너, 이미지를 컨트롤 하는 능력을 갖추고 싶다.

---

- CI/CD 기간 : 늘 그렇듯 기간이 아쉽다. 4주차때 갑자기 CI/CD를 부여받아 밤을 새가며 정말 열심히 하였지만, 목표치를 모두 구현하지 못한것들이 아쉽다. 무중단배포와 리버스프록시를 완료하지 못했다..
  <br><br>
- 애초 계획은 쿠버네티스를 이용한 무중단 배포였다. 그러나 첫시도에 무리한 계획이라는걸 깨닫기까지 하루밖에 걸리지 않았다......
  무중단 배포가 목표였는데, 현실적으로 빠르게 가능하지 않았고, 목표를 접은 것이 아쉬운 점으로 남았다.
  <br><br>
- jenkins 버전 이슈 시간낭비 : 이상하게도 Jenkins LTS 버전에서 많은 플러그인들이 설치되지 않았다. 나는 내가 잘못 설치했겠지 해서 계속 다시 설치해보아도 같은 증상이 반복되었고, 다른분에게 물어보았지만 답을 얻을 수 없었다. 그리고 하루 뒤 아는 사람을 통해 LTS버전 이상하니 latest버전으로 설치하라고 해서 했는데 잘 설치되었다....
  <br><br>
- node.js 플러그인 이슈으로 인한 시간낭비 : jenkins 내부에 node.js 플러그인을 설치하면 react로 작성된 코드를 jenkins선에서 build시킬 수 있다고 한다.
  하지만 이상하게도 설치가 되지 않았고, 이번에도 내 잘못이거니 하며 jenkins의 버전을 바꿔가며 계속 설치를 시도해 보았다.
  node.js가 지원을 시작한다는 jenkins 2.3xx버전부터 그 이후버전까지 계속 시도해보며 방법을 찾아가며 노력했는데, 이번에도 이 이슈의 근황을 아는 분에게 겨우 답변을 들을 수 있었다. jenkins와 node.js가 지금 호환이 안되는 것 같다고, 몇 개월전에 자기가 해보았을 때에는 됐었는데 지금은 안되어서 node.js이미지에서 react 코드를 build 시켰다고 한다... 이 말을 듣고 정말 힘이 빠졌지만 그분께서 말씀하신 대안으로 다시 시도하여 바로 성공할 수 있었다..
  <br><br>
- Docker in docker 이슈 : jenkins 컨테이너 내부에서 docker image를 build하려면 jenkins 컨테이너도 docker에 대한 권한을 얻어야 한다.  
   그러기 위해선 docker in docker방식을 사용하여 docker.sock이라는 파일을 EC2서버와 컨테이너가 마운트하여 파일을 공유하고,  
   docker.sock파일의 권한을 부여해주어야 하는데, 이게 정말정말 잘 안되었다....  
   "내가 권한을 꼬아버렸나보다" 하며 EC2를 초기화하고, 다시 CI/CD를 처음부터 진행하는 등의 노력을 하였지만 잘 되지않았고,  
   이때에는 약 13일동안 CI/CD만 주구장창 시도하고 깨지기를 반복하고 있을 때라서 멘탈이 조금 안좋았다...  
   "내가 무엇을 더 안해봤을까...내가 시도 안해본 경우의 수가 남아있기는 한가...?"하는 생각을 하고 있을 때 구글링해서 찾은 방식을 사용하니 갑자기 되어 허무했다.  
   권한 부여에 대해서는 아직 이해가 덜 되어서 다음 CI/CD때 더 잘 이해하도록 하겠다.  
   허무 맹랑하게 되었지만 이해를 위해서 권한을 다시 푸는 행동은 못하겠다....또 다 안될까봐...
  <br><br>
- 리버스 프록시 : 리버스 프록시를 시도하고 있었지만, 끝까지 진행하지 못하였다. AWS EC2의 도메인 네임에 직접 접근하는 것을 막기위해 가비아에서 도메인네임을 구매하였고, 리버스 프록시를 적용하여 EC2의 도메인네임을 접근하는 것들은 가비아에서 구매한 도메인 네임으로 리버스 프록시 할 예정이였다. 하지만 그때가 개발 마감 1주일 전이라서 프론트 코드 구현이 더 급하다고 판단하였고, 리버스 프록시는 지금 당장의 필수기능은 아니라고 판단하였기에 끝까지 마치지 않았다. 이러한 점이 아쉬움으로 남는다.

# 7. 프로젝트를 통해 배운점

- CI/CD.... 결코 쉽지 않았다...젠킨스와 Docker에 대한 개념만 가지고 있는 상태였는데 만만하게 봤다. 인프라 구성과 CI/CD, AI모델을 실행하기 위해 onPremise까지 인프라구성과 CI/CD를 진행한 기간은 총 16일 이였다. 나중에 알아보니 첫 경험치고는 빠르게 구성한 축에 속하는 것 같지만 환경구축은 에러메세지가 다 나오는 IDE환경에서의 개발과는 다르게 정말 어려운 점이 많았다. 하지만 나중에 DevOps 직무를 맡게 된다면 지금 경험하였던 pipeLine 작성법과 dockerfile 작성법 등의 지식이 많은 도움이 될 것이라고 느꼈다. 또한, 이번에 인프라 구성과 CI/CD를 진행하면서 빌드, 배포에 대해 정말 많은 지식이 생겨서 뿌듯하였다.
  <br><br>
- 팀원 분위기 : 이번 프로젝트에서 느낀점은 팀원 분위기가 좋은게 좋다라는거다...싸피 이전에 있었던 업무환경은 매우 엄중하고 무거운 분위기였다. 한때는 그런 분위기 속에서 엄청난 퍼포먼스를 내는것이 멋있다고 느꼈다. 그런 환경속에 있었기에 그렇게 일을 해야한다고 느껴왔는데, 그렇지 않고도 충분히 각자의 할 일을 잘 수행하며 좋은 분위기 속에서 업무는 계속 될 수 있다는 것을 느꼈다.
