<!DOCTYPE html>
<html>
<head>
    <title> Django 기본정리 |  Jiwon's Blog</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="author" content="Jiwon Ryu">
    <meta name="description" content="A blog and a portfolio">
    <link rel="shortcut icon" type="image/png" href="/image/개발자이모티콘2.png">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Crimson+Text">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.4.2/css/bulma.min.css">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@600&display=swap" rel="stylesheet">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-95PRM2RDE8"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-95PRM2RDE8');
    </script>
</head>

<body>
    <nav class="nav">
    <div class="container">
        <div class="nav-left">
            <a id="home" class="nav-item" href="/">
                <span class="icon">
                    <i class="fa fa-home"></i>
                </span>
            </a>
            
            <a id="project" class="nav-item " href="/project/">
                <span>Project</span>
            </a>
            
            <a id="category" class="nav-item " href="/category/">
                <span>Blog</span>
            </a>
            
        </div>

        <div class="nav-center">
            
        </div>

        <!--
        <span class="nav-toggle">
        <span></span>
        <span></span>
        <span></span>
        </span>

        
        <div class="nav-right nav-menu">
            
        </div>
        -->

</nav>
    <div class='content'>
        <section class="section">
  <div class="container">
    <div class="heading has-text-centered">
      <p class="title is-2">Django 기본정리</p>
      <p class="subtitle is-6">
        <span class="tag is-white"><small>March 02, 2023</small></span>
      </p>
    </div>
    <br />
    <div class="columns is-multiline">
      <div class="column is-half is-offset-one-quarter">
        <div class="content"><p>django 프로젝트 시작 방법, 기본적인 명령어 등 관련 설명을 정리해놓은 포스터입니다.</p>

<h1 id="공부방법">공부방법</h1>

<ol>
  <li>생활코딩 장고</li>
  <li>유튜브 마이쮸 클론코딩</li>
  <li>유튜브 어떤 분의 장고 튜토리얼 따라하기</li>
  <li>직접 프로그램 개발</li>
  <li>노마드코더 에어비엔비 클론코딩</li>
</ol>

<h1 id="명령어">명령어</h1>

<ol>
  <li>
    <p>django 프로젝트 생성</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">django</span><span class="o">-</span><span class="n">admin</span> <span class="nf">startproject </span><span class="p">(</span><span class="n">프로젝트명</span><span class="p">)</span>

<span class="n">ex</span><span class="p">)</span>
<span class="n">django</span><span class="o">-</span><span class="n">admion</span> <span class="n">startproject</span> <span class="n">myproject</span> <span class="c1"># =&gt; myproject 폴더를 만든 후 그 안에 프로젝트 생성
</span><span class="n">django</span><span class="o">-</span><span class="n">admion</span> <span class="n">startproject</span> <span class="n">myproject</span> <span class="p">.</span> <span class="c1"># =&gt; 현재 폴더안에 myproject 프로젝트 생성
</span></code></pre></div>    </div>
  </li>
  <li>
    <p>django 앱 생성</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">python</span> <span class="n">manage</span><span class="p">.</span><span class="n">py</span> <span class="nf">startapp </span><span class="p">(</span><span class="n">앱이름</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>마이그레이션 파일 생성</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">py</span> <span class="p">[</span><span class="n">manage</span><span class="p">.</span><span class="n">py</span><span class="p">](</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">manage</span><span class="p">.</span><span class="n">py</span><span class="p">)</span> <span class="n">makemigration</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>마이그레이트</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">py</span> <span class="p">[</span><span class="n">manage</span><span class="p">.</span><span class="n">py</span><span class="p">](</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">manage</span><span class="p">.</span><span class="n">py</span><span class="p">)</span> <span class="n">migrate</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>런서버 (3가지 예시)</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">py</span> <span class="p">[</span><span class="n">manage</span><span class="p">.</span><span class="n">py</span><span class="p">](</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">manage</span><span class="p">.</span><span class="n">py</span><span class="p">)</span> <span class="n">runserver</span>
<span class="n">py</span> <span class="n">manage</span><span class="p">.</span><span class="n">py</span> <span class="mi">8000</span>           <span class="c1"># 8000번 포트로 런서버
</span><span class="n">py</span> <span class="n">manage</span><span class="p">.</span><span class="n">py</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">200.001</span><span class="p">:</span><span class="mi">8000</span>       <span class="c1"># 해당IP와 포트에 런서버
</span></code></pre></div>    </div>
  </li>
  <li>
    <p>슈퍼유저 생성 (명령어 입력 후 아이디, 이메일, 비밀번호, 비밀번호확인 입력하여 생성)</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">py</span> <span class="n">manage</span><span class="p">.</span><span class="n">py</span> <span class="n">createsuperuser</span>
</code></pre></div>    </div>
  </li>
</ol>

<h1 id="개발순서">개발순서</h1>

<ol>
  <li>APP생성</li>
  <li>model 생성</li>
  <li>admin페이지 커스텀</li>
  <li>URL 및 View , serializers 코딩</li>
  <li>Authontication 코딩</li>
  <li>environment file 생성하여 배포</li>
  <li>백엔드 API testing (py manage.py test)로 백엔드 test)</li>
  <li>front-end 만들기</li>
</ol>

<h1 id="adminpy-사용예시">admin.py 사용예시</h1>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="n">.models</span> <span class="kn">import</span> <span class="n">House</span>

<span class="nd">@admin.register</span><span class="p">(</span><span class="n">House</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HouseAdmin</span><span class="p">(</span><span class="n">admin</span><span class="p">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="c1"># # houses의 각 house 상세 페이지에서 보여줄 필드들의 묶음을 지정
</span>    <span class="c1"># fields = ("name", "address", ("price_per_night", "pets_allowed"))
</span>
    <span class="c1"># # admin 페이지의 houses 목록에서 검색을 할 필드들을 지정
</span>    <span class="c1"># search_fields = ("address",)
</span>    <span class="c1"># # 아래 튜플에 지정한 필드들을 링크로 지정한다. house 목록에서 house 상세페이지로 진입하기 위한 링크이다.
</span>    <span class="c1"># list_display_links = ("name", "address")
</span>    <span class="c1"># # admin의 houses 목록에서 바로 수정할 수 있는 필드들을 지정. 상세진입까지 필요없고 리스트에서 수정가능.
</span>    <span class="c1"># list_editable = ("pets_allowed",)
</span>
    <span class="c1"># # admin 페이지의 houses 목록에서 수정하지 않을 필드들을 지정
</span>    <span class="c1"># # price_per_night를 admin 페이지에서 수정할 수 없게 된다.
</span>    <span class="c1"># exclude = ("price_per_night",)
</span>
    <span class="c1"># admin 페이지의 houses 목록에서 보여줄 필드들을 지정
</span>    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">price_per_night</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">address</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">pets_allowed</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">owner</span><span class="sh">"</span><span class="p">)</span>
    <span class="c1"># admin 페이지의 houses 목록에서 필터를 보여줄 필드들을 지정
</span>    <span class="n">list_filter</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">price_per_night</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">pets_allowed</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h1 id="django의-restapi">Django의 RestAPI</h1>

<ol>
  <li>요즘은 Template는 잘 사용하지 않는다.</li>
  <li>API를 활용하여 프론트엔드와 연결하여 많이 사용한다.</li>
  <li>Json 형태로 문자를 반환해주는 JsonResponse도 잘 사용하지 않는다.</li>
  <li>Django serialization 프레임워크는 장고 모델을 다른 포멧으로 변환해주는 방법을 제공해준다.
    <ol>
      <li>ex) XML, JSON, JSONL, YAML 등..</li>
      <li>하지만 Django serialization 프레임워크는 커스터마이징을 위한 기능이 적어서 불편하다.</li>
    </ol>
  </li>
  <li>그래서 커스텀 기능을 사용하기도 한다.</li>
  <li>
    <p><a href="http://views.py">views.py</a> 파일에 아래 명령어를 import 한다.</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">rest_framework.decorators</span> <span class="kn">import</span> <span class="n">api_view</span>
<span class="kn">from</span> <span class="n">rest_framework.response</span> <span class="kn">import</span> <span class="n">Response</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>함수명 위에 데코레이션을 붙여넣으면 drf를 사용가능하다.</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@api_view</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">categories</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</code></pre></div>    </div>
  </li>
  <li>커스텀 할 때에는 serializers.py를 생성하여 그쪽에 시리얼라이르 라이브러리를 import한 class를 사용하여 json을 어떤 형식으로 내보낼 것인지 커스터마이징이 가능하다.</li>
  <li>serialization 모델은 django에서 json으로 내보내는 역할 뿐만 아니라, json에서 django로 변환할때도 사용된다.</li>
  <li>
    <p>serializer는 instance와 data 두개의 변수를 매개변수를 받는다.</p>

    <ol>
      <li>instance는 클라이언트에 내보낼때 사용되고, data는 클라이언트로부터 받은 정보를 django로 가져올 때 사용된다.</li>
    </ol>
  </li>
  <li>함수를 이용한 Rest API 방식이 있고, class를 이용한 Rest API방식이 있다. 그리고 ViewSet을 이용한 방식이 또 있다.</li>
  <li>serializers.py에서는 어떤 데이터를 내보내고 받을지에 대한 것들을 정의한다.</li>
  <li><a href="http://serializers.py">serializers.py</a> 파일을 구성하는 class는 serializer를 사용한 방식이 있고, Modelserializer을 사용한 방식이 있다. model과 serializer이 많은 부분이 겹치기 때문에 serializer를 보완한 방식이 Modelserializer 방식이다.</li>
</ol>

<p>결론 : view에서는 APIView를 이용한 class를 사용하고, serializers.py에서는 Modelsirializer를 사용한 class를 사용하면 나머지는 똑같다.</p>

<h1 id="authentication">Authentication</h1>

<ol>
  <li>
    <p>BasicAuthentication</p>

    <ol>
      <li>기본인증방식을 사용한다. 사용자가 입력한 username과 password를 base64로 인코딩하여 Authorization헤더에 담아서 서버로 보낸다. 서버는 이를 디코딩하여 username과 password를 확인한다. 로그인을 위한팝업창이 나타난다.</li>
      <li>
        <p>settings.py에 아래와 같은 명령어를 추가해야한다.</p>

        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>REST_FRAMEWORK = {
    "DEFAULT_AUTHENTICATION_CLASSES": [                             # 인증방식을 지정한다.
        "rest_framework.authentication.BasicAuthentication",
    ]
}
</code></pre></div>        </div>
      </li>
      <li>잘 사용하지 않는 방식이다.</li>
    </ol>
  </li>
  <li>SessionAuthentication
    <ol>
      <li>장고의 기본적인 인증방식</li>
    </ol>
  </li>
  <li>
    <p>TokenAuthentication</p>

    <ol>
      <li>토큰 인증방식</li>
      <li>
        <p>settings.py에 아래와 같은 명령어를 추가해야한다.</p>

        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>REST_FRAMEWORK = {
    "DEFAULT_AUTHENTICATION_CLASSES": [                             # 인증방식을 지정한다.
        "rest_framework.authentication.TokenAuthentication",        # auth-token 인증을 사용한다.
    ]
}
</code></pre></div>        </div>
      </li>
      <li>client에서 server로 보낼 때 body에 {”username”:username,”password”:password} 로 json을 보내면 토큰이 반환된다.</li>
      <li>그 이후에는 hearder에 {”Authorization”:token}과 같이 json 형태로 토큰을 실어보내어 서버에서 사용자를 구별한다.</li>
      <li>사용자가 많을수록 데이터베이스에 부하가 커진다.</li>
    </ol>
  </li>
  <li>
    <p>JWT 인증방식</p>

    <ol>
      <li>pyJWT 라이브러리를 사용한다. pip install pyjwt로 설치</li>
      <li>JWT 인증 클래스를 따로 만들어 사용해야한다.</li>
      <li>사용자가 로그인을 하여 로그인에 성공하면 유저정보를 암호화하여 JWT토큰을 보낸다.</li>
      <li>사용자는 로그인 이후로 JWT를 header에 Json형태로 실어 보낸다.</li>
      <li>서버는 JWT를 복호화하여 유저정보를 추출한다.</li>
    </ol>

    <h1 id="environment-files">Environment files</h1>

    <ol>
      <li>가장 바깥 폴더에 .env 파일 생성</li>
      <li>장고가 env파일을 읽게 하기 위한 django-environ 라이브러리 설치(pip install django-environ)</li>
      <li>settings.py 파일에 import os, environ을 써서 on와 environ을 import하기.</li>
      <li>
        <p>settings.py파일에 아래와 같은 명령어가 추가되어야 한다.</p>

        <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">**</span><span class="n">env</span> <span class="o">=</span> <span class="n">environ</span><span class="p">.</span><span class="nc">Env</span><span class="p">()</span> <span class="c1">#   .env파일을 읽어서 환경변수를 설정한다.**
</span>
<span class="c1"># Build paths inside the project like this: BASE_DIR / 'subdir'.
</span><span class="n">BASE_DIR</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">__file__</span><span class="p">).</span><span class="nf">resolve</span><span class="p">().</span><span class="n">parent</span><span class="p">.</span><span class="n">parent</span>

<span class="o">**</span><span class="n">environ</span><span class="p">.</span><span class="n">Env</span><span class="p">.</span><span class="nf">read_env</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="sh">"</span><span class="s">.env</span><span class="sh">"</span><span class="p">))</span>     <span class="c1"># .env파일을 읽어서 환경변수를 설정한다.**
</span>
<span class="c1"># Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/4.2/howto/deployment/checklist/
</span>
<span class="c1"># SECURITY WARNING: keep the secret key used in production secret!
</span><span class="o">**</span><span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="nf">env</span><span class="p">(</span><span class="sh">"</span><span class="s">SECRET_KEY</span><span class="sh">"</span><span class="p">)</span>      <span class="c1"># .env파일에서 SECRET_KEY를 읽어온다**.
</span></code></pre></div>        </div>

        <ol>
          <li>env = environ.Env()를 써서 .env 파일을 읽는 변수를 지정한다.</li>
          <li><strong>environ.Env.read_env(os.path.join(BASE_DIR, “.env”))</strong>를 써서 .env 파일의 위치를 알려준다.</li>
          <li><strong>SECRET_KEY = env(“SECRET_KEY”)</strong>를 써서 SECRET_KEY를 django에 넣어두고 사용하지 않고, 환경변수파일을 읽음으로서 secret_Key를 읽도록 사용할 수 있다. secret_key를 안전하게 관리하는 방법이다.</li>
        </ol>
      </li>
      <li>이러한 방식으로 Secret_key를 숨기기는 했지만 다른 파일과 다른 방식으로 secret_Key를 숨겨도 상관은 없다.
6.</li>
    </ol>

    <h1 id="testting">TESTTING</h1>

    <p>실행방법</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">py</span> <span class="n">manage</span><span class="p">.</span><span class="n">py</span>
</code></pre></div>    </div>

    <p>위 코드를 작성하면 django project내의 test파일이 모드 실행되며 테스트를 진행한다.</p>

    <p>백엔드 api를 구성하였으면 test.py 파일에서 테스트코드를 작성하여 테스트를 진행한다.</p>

    <p>api를 작성하였다면 self.client 메소드를 사용하여 test파일이 클라이언트처럼 행동하며 api에 데이터를 보낸다. 그 데이터를 테스트 하는 것이다.</p>

    <p>test는 DB를 생성하고 test를 진행 한 후 DB를 바로 지운다. 그래서 DB 안에 들어있는 데이터가 없다. 즉, 원본 DB를 건드리지 않고 test한다는 뜻이다.</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">rest_framework.test</span> <span class="kn">import</span> <span class="n">APITestCase</span>

<span class="k">class</span> <span class="nc">TestAmenities</span><span class="p">(</span><span class="n">APITestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_two_plue_two</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">client</span><span class="p">.</span>
</code></pre></div>    </div>
  </li>
</ol>
</div>
      </div>
    </div>
    
    <div id="disqus" style="padding: 41px"><div id="disqus_thread"></div>
<script>
    /**
    *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
    *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
    
    var disqus_config = function () {
    this.page.url = "https://koreamarin.github.io//backend/2023/03/02/Django-%EA%B8%B0%EB%B3%B8%EC%A0%95%EB%A6%AC/";  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = 'Django 기본정리'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://koreamarin-github-io.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
    
  </div>
</section>

    </div>
    <footer style='background-color: #eefffd;'>
    <address class="footer_wrap">
        <div class="information">
            <div class="myname">
                Jiwon's Blog
            </div>
            <a href="mailto:awldnjs2@gmail.com" class="email">
                awldnjs2@gmail.com
            </a>
            <div class="accounts">
                <span class="icon">
                    <a class="nav-item" target="_blank" href="https://www.github.com/koreamarin/">
                        <i class="fa fa-github"></i>
                    </a>
                </span>
                
                <!--
                    <span class="icon">
                        <a class="nav-item" target="_blank" href="https://www.twitter.com/username/">
                            <i class="fa fa-twitter"></i>
                        </a>
                    </span>
                -->
            </div>
        </div>
        <div class="copyright">
            <span>
                © koreamarin. <span id="year">2023</span>
            </span>
        </div>    
    </address>
</footer>
    <script src="/js/script.js"></script>
</body>

</html>