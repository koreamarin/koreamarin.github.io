<!DOCTYPE html>
<html>
<head>
    <title> QueryDSL |  Jiwon's Blog</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="author" content="Jiwon Ryu">
    <meta name="description" content="A blog and a portfolio">
    <link rel="shortcut icon" type="image/png" href="/image/ê°œë°œìì´ëª¨í‹°ì½˜2.png">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Crimson+Text">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.4.2/css/bulma.min.css">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@600&display=swap" rel="stylesheet">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-95PRM2RDE8"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-95PRM2RDE8');
    </script>
</head>

<body>
    <nav class="nav">
    <div class="container">
        <div class="nav-left">
            <a id="home" class="nav-item" href="/">
                <span class="icon">
                    <i class="fa fa-home"></i>
                </span>
            </a>
            
            <a id="project" class="nav-item " href="/project/">
                <span>Project</span>
            </a>
            
            <a id="category" class="nav-item " href="/category/">
                <span>Blog</span>
            </a>
            
        </div>

        <div class="nav-center">
            
        </div>

        <!--
        <span class="nav-toggle">
        <span></span>
        <span></span>
        <span></span>
        </span>

        
        <div class="nav-right nav-menu">
            
        </div>
        -->

</nav>
    <div class='content'>
        <section class="section">
  <div class="container">
    <div class="heading has-text-centered">
      <p class="title is-2">QueryDSL</p>
      <p class="subtitle is-6">
        <span class="tag is-white"><small>July 11, 2024</small></span>
      </p>
    </div>
    <br />
    <div class="columns is-multiline">
      <div class="column is-half is-offset-one-quarter">
        <div class="content"><p>QueryDSLì„ ì†Œê°œí•˜ê³ , ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ì„œ ì‘ì„±í•œ ê¸€</p>

<p>ì°¸ê³ í•  ë ˆí¬ì§€í† ë¦¬ : <a href="https://github.com/koreamarin/PracticalTestCode">ğŸ”— https://github.com/koreamarin/PracticalTestCode</a></p>

<h1 id="ëª©ì°¨">ëª©ì°¨</h1>

<h4 id="1-querydsl-ì†Œê°œ">1. QueryDSL ì†Œê°œ</h4>

<h4 id="2-querydsl--spring-data-jpa-í™˜ê²½-ì„¤ì •ì„-ìœ„í•œ-import-ë°©ë²•">2. QueryDSL + Spring Data JPA í™˜ê²½ ì„¤ì •ì„ ìœ„í•œ import ë°©ë²•</h4>

<h4 id="3-ë²Œí¬ì—°ì‚°ì˜-ì£¼ì˜ì ">3. ë²Œí¬ì—°ì‚°ì˜ ì£¼ì˜ì </h4>

<h4 id="4-querydslê³¼-dto-ì—°ê²°-ë°©ë²•-4ê°€ì§€-ì†Œê°œì™€-ê°€ì¥-ì¶”ì²œí•˜ëŠ”-ë°©ì‹">4. QueryDSLê³¼ DTO ì—°ê²° ë°©ë²• 4ê°€ì§€ ì†Œê°œì™€ ê°€ì¥ ì¶”ì²œí•˜ëŠ” ë°©ì‹</h4>

<h4 id="5-querydslì„-ì´ìš©í•œ-ë™ì ì¿¼ë¦¬-ë°©ë²•-2ê°€ì§€-ì†Œê°œì™€-ì¶”ì²œí•˜ëŠ”-ë°©ì‹">5. QueryDSLì„ ì´ìš©í•œ ë™ì ì¿¼ë¦¬ ë°©ë²• 2ê°€ì§€ ì†Œê°œì™€ ì¶”ì²œí•˜ëŠ” ë°©ì‹</h4>

<h4 id="6-í˜ì´ì§•-ì²˜ë¦¬-ë°©ì‹ê³¼-í˜ì´ì§•-ì„±ëŠ¥-ìµœì í™”-ê¸°ë²•">6. í˜ì´ì§• ì²˜ë¦¬ ë°©ì‹ê³¼ í˜ì´ì§• ì„±ëŠ¥ ìµœì í™” ê¸°ë²•</h4>

<hr />

<h1 id="1-querydsl-ì†Œê°œ-1">1. QueryDSL ì†Œê°œ</h1>

<p>QueryDSLì€ JPQLì˜ ë‹¨ì ì„ ë³´ì™„í•˜ê¸° ìœ„í•´ ë“±ì¥í•˜ì˜€ë‹¤.
JPQLì€ ë¬¸ìì—´ í˜•íƒœë¡œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•´ì•¼ í•´ì„œ IDEì—ì„œ ì˜¤ë¥˜ë¥¼ ì¡ì•„ì£¼ì§€ ëª»í•˜ê³ , runtimeí™˜ê²½ì—ì„œë§Œ ì—ëŸ¬ê°€ ë°œê²¬ëœë‹¤ëŠ” ë‹¨ì ì´ ìˆë‹¤.<br />
QueryDSLì„ ì‚¬ìš©í•˜ë©´ SQLë¬¸ë²•ì„ ì‘ì„±í•  ë•Œì²˜ëŸ¼ ì§ê´€ì ì¸ ë¬¸ë²•ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, IDEì—ì„œ ë¬¸ë²•ì˜¤ë¥˜ë¥¼ ì¡ì•„ì¤€ë‹¤.<br />
ë˜í•œ, ì¿¼ë¦¬ë¥¼ ë™ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë™ì ì¿¼ë¦¬ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ë„ ìˆë‹¤.<br />
QueryDSLì€ JPQLì˜ ë‹¨ì ì„ ë³´ì™„í•´ì¤€, JPQLì„ ë¹Œë”í•˜ëŠ” ì—­í• ì„ í•˜ì—¬ DBì—ì„œ Entityì— ë§¤ì¹­í•˜ëŠ” ì—­í•­ì„ ëŒ€ì‹ í•´ì¤€ë‹¤.</p>

<hr />

<h1 id="2-querydsl--spring-data-jpa-í™˜ê²½-ì„¤ì •ì„-ìœ„í•œ-import-ë°©ë²•-1">2. QueryDSL + Spring Data JPA í™˜ê²½ ì„¤ì •ì„ ìœ„í•œ import ë°©ë²•</h1>

<h2 id="querydslapplicationjava-application-íŒŒì¼">QuerydslApplication.java (Application íŒŒì¼)</h2>

<p>JPAQueryFactoryí´ë˜ìŠ¤ë¥¼ EntityManagerë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹ˆìœ¼ë¡œ ë“±ë¡í•œë‹¤.<br />
EntityManagerëŠ” ìë™ìœ¼ë¡œ Spring Data JPAì— ì˜í•´ ë¹ˆì— ë“±ë¡ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ë°˜ìœ¼ë¡œ ë“±ë¡í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@SpringBootApplication
public class QuerydslApplication {

 public static void main(String[] args) {
  SpringApplication.run(QuerydslApplication.class, args);
 }

 @Bean
 JPAQueryFactory jpaQueryFactory(EntityManager em) {  // JPAQueryFactoryë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡
  return new JPAQueryFactory(em);
 }

}
</code></pre></div></div>

<hr />

<h2 id="buildgradle">build.gradle</h2>

<p>plugins ì† QueryDSL êµ¬ë¬¸, dependencies ì† QueryDSL êµ¬ë¬¸, dependenciesì•„ë˜ì— ìˆëŠ” ì¿¼ë¦¬ ê´€ë ¨ êµ¬ë¬¸ì„ ì‚¬ìš©í•œë‹¤.<br />
QueryDSLì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” QíŒŒì¼ì´ë¼ëŠ” ê²ƒì´ í•„ìš”í•œë°, ì‹¤í–‰ì„ í•˜ë©´ QíŒŒì¼ì´ buildí´ë” ë‚´ì— ìƒì„±ëœë‹¤.<br />
ì´ ìƒì„±ëœ QíŒŒì¼ì€ ê°œë°œì‹œì—ë„ ì“°ì´ê³ , Buildí´ë” ë‚´ì— ìˆìœ¼ë¯€ë¡œ ì‹¤ì œ ìš´ì˜í™˜ê²½ì—ì„œë„ ì“°ì¼ ìˆ˜ ìˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>plugins {
 id 'java'
 id 'org.springframework.boot' version '3.3.1'
 id 'io.spring.dependency-management' version '1.1.5'

 // querydsl ì¶”ê°€
 id "com.ewerk.gradle.plugins.querydsl" version "1.0.10"
}

group = 'study'
version = '0.0.1-SNAPSHOT'

java {
 toolchain {
  languageVersion = JavaLanguageVersion.of(17)
 }
}

configurations {
 compileOnly {
  extendsFrom annotationProcessor
 }
}

repositories {
 mavenCentral()
}

dependencies {
 // spring boot
 implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
 implementation 'org.springframework.boot:spring-boot-starter-web'

 // lombok
 compileOnly 'org.projectlombok:lombok'
 annotationProcessor 'org.projectlombok:lombok'

 // h2
 runtimeOnly 'com.h2database:h2'

 // test
 testImplementation 'org.springframework.boot:spring-boot-starter-test'
 testRuntimeOnly 'org.junit.platform:junit-platform-launcher'

 // querydsl ì¶”ê°€
 implementation 'com.querydsl:querydsl-jpa:5.0.0:jakarta'
 annotationProcessor "com.querydsl:querydsl-apt:${dependencyManagement.importedProperties['querydsl.version']}:jakarta"
 annotationProcessor "jakarta.annotation:jakarta.annotation-api"
 annotationProcessor "jakarta.persistence:jakarta.persistence-api"

 implementation "com.github.gavlyukovskiy:p6spy-spring-boot-starter:1.9.0" // querydsl ë¡œê·¸ í™•ì¸ìš©
}

tasks.named('test') {
 useJUnitPlatform()
}

// querydsl ì¶”ê°€ ì‹œì‘
def querydslDir = "$buildDir/generated/querydsl"

querydsl {
 jpa = true
 querydslSourcesDir = querydslDir
}
sourceSets {
 main.java.srcDir querydslDir
}
configurations {
 querydsl.extendsFrom compileClasspath
}
compileQuerydsl {
 options.annotationProcessorPath = configurations.querydsl
}
// querydsl ì¶”ê°€ ë
</code></pre></div></div>

<hr />

<h2 id="applicationyml">application.yml</h2>

<p>ë§Œì•½ QueryDSLë¡œ ìƒì„±ëœ JPQLë¬¸ë²•ì„ ë¡œê·¸ì—ì„œ í™•ì¸í•˜ê³  ì‹¶ë‹¤ë©´ application.yml íŒŒì¼ì—ì„œ ì•„ë˜ êµ¬ë¬¸ì„ ì¶”ê°€í•œë‹¤
spring.jpa.properties.hibernate.use_sql_comments: true</p>

<hr />

<h2 id="ê·¸-ì™¸-í•„ìš”í•œ-íŒŒì¼ë“¤">ê·¸ ì™¸ í•„ìš”í•œ íŒŒì¼ë“¤</h2>

<p>QueryDSLì„ Spring Data JPAì—ì„œ ì‚¬ìš©í•˜ë ¤ë©´ êµ¬í˜„ì½”ë“œë¥¼ ë§Œë“¤ì–´ì„œ ì¨ì•¼í•˜ëŠ”ë° Spring Data JPAëŠ” ì¸í„°í˜ì´ìŠ¤ í˜•íƒœë¡œ ë˜ì–´ ìˆì–´ì„œ,<br />
ë‚´ê°€ ì›í•˜ëŠ” êµ¬í˜„ ì½”ë“œë¥¼ ë„£ìœ¼ë ¤ë©´ ì‚¬ìš©ì ì •ì˜ ë¦¬í¬ì§€í† ë¦¬ë¥¼ ë§Œë“¤ì–´ì„œ ìƒì†í•˜ëŠ” ì¡°ê¸ˆ ë³µì¡í•œ ë°©ë²•ì„ ì¨ì•¼í•œë‹¤.<br />
ì¦‰, ì‚¬ìš©ì ì •ì˜ ë¦¬í¬ì§€í† ë¦¬ë¥¼ ìƒì„±í•´ì•¼ í•œë‹¤.</p>

<p>Memberë¼ëŠ” Entityê°€ ìˆë‹¤ê³  ì¹˜ë©´,<br />
Member Entityë¥¼ ë§¤í•‘í•˜ê¸° ìœ„í•´ í•„ìš”í•œ RepositoryíŒŒì¼ì€ 3ê°€ì§€ê°€ í•„ìš”í•˜ë‹¤.</p>

<ol>
  <li>ìŠ¤í”„ë§ ë°ì´í„° ë¦¬í¬ì§€í† ë¦¬ì— ì‚¬ìš©ì ì •ì˜ ì¸í„°í˜ì´ìŠ¤ ìƒì†<br />
[MemberRepository ì¸í„°í˜ì´ìŠ¤]<br />
 (JpaRepositoryì™€ MemberRepositoryCustom ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†ë°›ìŒ)
<br /><br /></li>
  <li>ì‚¬ìš©ì ì •ì˜ ì¸í„°í˜ì´ìŠ¤ ì‘ì„±<br />
[MemberRepositoryCustom ì¸í„°í˜ì´ìŠ¤]
<br /><br /></li>
  <li>ì‚¬ìš©ì ì •ì˜ ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„<br />
[MemberRepositoryImpl êµ¬í˜„ì²´]<br />
 (MemberRepositoryCustom ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ì²´. ì´ë¦„ìƒì„±ì‹œ JpaRepositoryì— ì—°ê²°ëœ ì¸í„°í˜ì´ìŠ¤ ì´ë¦„ + Impl ì´ë¼ëŠ” ê·œì¹™ì„ ì§€ì¼œì£¼ì–´ì•¼ í•¨.)</li>
</ol>

<hr />

<h1 id="3-ë²Œí¬ì—°ì‚°ì˜-ì£¼ì˜ì -ë‹¨ê±´x-ë‹¤ê±´-update">3. ë²Œí¬ì—°ì‚°ì˜ ì£¼ì˜ì  (ë‹¨ê±´X, ë‹¤ê±´ UPDATE)</h1>

<p>ë²Œí¬ ì—°ì‚°ì€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ë¬´ì‹œí•˜ê³  ë°”ë¡œ DBì— ì¿¼ë¦¬ë¥¼ ë‚ ë¦°ë‹¤.<br />
ê·¸ë˜ì„œ DBì™€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ê°’ì´ ë‹¤ë¥¼ ìˆ˜ ìˆë‹¤. ë²Œí¬ ì—°ì‚° ìˆ˜í–‰ í›„ì—ëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ê¼­ ì´ˆê¸°í™” í•´ì£¼ê¸°</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    @DisplayName("ë²Œí¬ ì—°ì‚° - ë‚˜ì´ê°€ 28ì‚´ ì´í•˜ì¸ íšŒì›ì˜ ë‚˜ì´ë¥¼ 20ì‚´ë¡œ ë³€ê²½í•˜ê¸°")
    @Test
//    @Commit // ì´ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•  ë•Œì—ëŠ” commitì„ í•´ì„œ DBì™€ ì˜ì†ì„±ì»¨í…ìŠ¤íŠ¸ ë¹„êµí•˜ê¸°, Transactionalì— ì˜í•´ ì›ë˜ëŠ” ì´ˆê¸°í™” ë˜ì§€ë§Œ, commitì„ ë¶™ì´ë©´ DBì— ë°˜ì˜ì´ ë¨.
    void bulkUpdate() {
        long count = queryFactory
                .update(member)
                .set(member.username, "ë¹„íšŒì›")
                .where(member.age.lt(28))
                .execute();

        // bulkì—°ì‚°ì€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ë¬´ì‹œí•˜ê³  DBì— ë°”ë¡œ ì¿¼ë¦¬ë¥¼ ë‚ ë¦¼
        /** member1 = 10 -&gt; DB ë¹„íšŒì›      ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ member1
         * member2 = 20 -&gt; DB ë¹„íšŒì›       ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ member2
         * member3 = 30 -&gt; DB member3     ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ member3
         * member4 = 40 -&gt; DB member4     ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ member4
         */

        // ì´ë•Œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì™€ DBì˜ ë°ì´í„°ê°€ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ì´ˆê¸°í™”í•´ì£¼ì–´ì•¼ í•¨.
        // ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ìˆëŠ” ë°ì´í„°ê°€ ìš°ì„ ê¶Œì„ ê°€ì§€ê¸° ë•Œë¬¸ì— DBì—ì„œ ë‹¤ì‹œ ë¶ˆëŸ¬ì™€ë„ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ìˆëŠ” ë°ì´í„°ê°€ ìš°ì„ ê¶Œì„ ê°€ì ¸ì„œ ë°˜ì˜ë˜ì§€ ì•ŠìŒ.
        List&lt;Member&gt; result1 = queryFactory
                .selectFrom(member)
                .fetch();
        for (Member member1 : result1) {
            System.out.println("member1 = " + member1);
        }
        /**
         *  member1 = Member(id=1, username=member1, age=10)
         *  member2 = Member(id=2, username=member2, age=20)
         *  member3 = Member(id=3, username=member3, age=30)
         *  member4 = Member(id=4, username=member4, age=40)
         */


        // ê·¸ëŸ¬ê¸° ë•Œë¬¸ì— ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ì´ˆê¸°í™”í•´ì£¼ì–´ì•¼ í•¨.
        em.flush();
        em.clear();

        // ì´ˆê¸°í™” ì´í›„ DBì—ì„œ ë‹¤ì‹œ ì¡°íšŒ
        List&lt;Member&gt; result2 = queryFactory
                .selectFrom(member)
                .fetch();

        for (Member member1 : result2) {
            System.out.println("member1 = " + member1);
        }
        /**
         *  member1 = Member(id=1, username=ë¹„íšŒì›, age=10)
         *  member2 = Member(id=2, username=ë¹„íšŒì›, age=20)
         *  member3 = Member(id=3, username=member3, age=30)
         *  member4 = Member(id=4, username=member4, age=40)
         */
    }
</code></pre></div></div>

<h1 id="4-querydslê³¼-dto-ì—°ê²°-ë°©ë²•-4ê°€ì§€-ì†Œê°œì™€-ê°€ì¥-ì¶”ì²œí•˜ëŠ”-ë°©ì‹-1">4. QueryDSLê³¼ DTO ì—°ê²° ë°©ë²• 4ê°€ì§€ ì†Œê°œì™€ ê°€ì¥ ì¶”ì²œí•˜ëŠ” ë°©ì‹</h1>

<p>queryDSLì„ ì´ìš©í•˜ì—¬ DTOì— ì—°ê²°í•˜ëŠ” ë°©ì‹ì€ 4ê°€ì§€ê°€ ìˆë‹¤.</p>

<ol>
  <li>í”„ë¡œí¼í‹° ì ‘ê·¼ë°©ì‹(DTOì— ê¸°ë³¸ìƒì„±ìì™€ Setterí•„ìš”)</li>
  <li>field ì ‘ê·¼ë°©ì‹</li>
  <li>constructorë¥¼ ì´ìš©í•œ ìƒì„±ì ì ‘ê·¼ ë°©ì‹(DTOì— ëª¨ë“  í•„ë“œ ìƒì„±ìê°€ í•„ìš”)</li>
  <li>queryProjectionë¥¼ ì´ìš©í•œ ìƒì„±ì ì ‘ê·¼ ë°©ì‹(DTOì— ëª¨ë“  í•„ë“œ ìƒì„±ìì™€ ê·¸ ìœ„ @QueryProjection ì–´ë…¸í…Œì´ì…˜ì´ í•„ìš”) [ì¶”ì²œë°©ì‹]</li>
</ol>

<p>ì´ ë„¤ê°€ì§€ë¥¼ ì‚¬ìš©í•œ ë°©ì‹ì´ ìˆë‹¤.</p>

<p>3ë²ˆ ë°©ì‹ constructor ìƒì„±ì ì ‘ê·¼ ë°©ì‹ì€ ideì—ì„œ ì˜¤ë¥˜ë¥¼ ëª» ì¡ì•„ ì¤„ ë–„ê°€ ìˆë‹¤. ëŸ°íƒ€ì„ì„ í•´ë´ì•¼ ì˜¤ë¥˜ë¥¼ ë°œê²¬í•  ìˆ˜ ìˆì–´ì„œ ìœ„í—˜í•˜ë‹¤.<br />
4ë²ˆ ë°©ì‹ QueryProjectionì€ ì´ëŸ° ê²ƒì„ í•´ê²°í•´ ì£¼ì–´ IDEì—ì„œ ì˜¤ë¥˜ë¥¼ ë°œê²¬í•˜ì—¬ ì¤€ë‹¤.<br />
QueryProjectionì„ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì—ë„ ë‹¨ì ì´ ìˆëŠ”ë°, ì–´ë…¸í…Œì´ì…˜ì„ DTOì˜ ìƒì„±ìì— ë¶™ì—¬ì•¼í•œë‹¤ëŠ” ì ì´ë‹¤.
ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì„ìœ¼ë¡œì¨ DTOëŠ” QueryDSLì— ê²°í•©ë„ê°€ ë†’ì•„ì ¸ ë²„ë¦°ë‹¤.<br />
ë‚˜ì¤‘ì— querydslì„ ë¹¼ê±°ë‚˜ í•˜ëŠ”ë“±ì˜ ë³€ê²½ì´ ìˆì„ ì‹œ, DTOì—ì„œ ì—ëŸ¬ê°€ ë‚˜ê²Œ ë  ê²ƒì´ë‹¤.</p>

<p>DTOë¥¼ ê¹”ë”í•˜ê²Œ ê°€ì ¸ê°€ê³  ì‹¶ë‹¤ë©´(QueryDSLì— ê²°í•©ì„± ìˆì§€ ì•Šê²Œ DTOë¥¼ ê°€ì ¸ê°€ê³  ì‹¶ë‹¤ë©´) 3ë²ˆ ë°©ì‹ì¸ constructor ìƒì„±ì ì ‘ê·¼ ë°©ì‹ìœ¼ë¡œ DTOë¥¼ ë§¤í•‘í•´ì£¼ëŠ” ê²ƒì´ ì¢‹ë‹¤.</p>

<h2 id="testcodeë¡œ-ë³´ëŠ”-ì˜ˆì‹œ">TestCodeë¡œ ë³´ëŠ” ì˜ˆì‹œ</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    @DisplayName("JPQLì„ ì‚¬ìš©í•˜ì—¬ DTOë¡œ ì¡°íšŒí•˜ê¸°")
    @Test
    void findDtoByJPQL() {
        List&lt;MemberDto&gt; result = em.createQuery("select new study.querydsl.dto.MemberDto(m.username, m.age) from Member m", MemberDto.class)
                .getResultList();

        for (MemberDto memberDto : result) {
            System.out.println("memberDto = " + memberDto);
        }
    }

    @DisplayName("QueryDSLì„ ì‚¬ìš©í•˜ì—¬ DTOë¡œ ì¡°íšŒí•˜ê¸° - í”„ë¡œí¼í‹° ì ‘ê·¼(DTOì— ê¸°ë³¸ìƒì„±ì í•„ìš”, ê¸°ë³¸ìƒì„±ìë¡œ ìƒì„±í•œ í›„ setterë¡œ ê°’ ì£¼ì…í•˜ëŠ” ë°©ì‹)")
    @Test
    void findDtoBySetter() {
        List&lt;MemberDto&gt; result = queryFactory
                .select(
                        Projections.bean(MemberDto.class,
                                member.username,
                                member.age))
                .from(member)
                .fetch();

        for (MemberDto memberDto : result) {
            System.out.println("memberDto = " + memberDto);
        }
    }

    @DisplayName("QueryDSLì„ ì‚¬ìš©í•˜ì—¬ DTOë¡œ ì¡°íšŒí•˜ê¸° - í•„ë“œ ì§ì ‘ ì ‘ê·¼(DTOì— ê¸°ë³¸ìƒì„±ì í•„ìš”, í•„ë“œ ì§ì ‘ ì ‘ê·¼ ë°©ì‹)")
    @Test
    void findDtoByField() {
        List&lt;MemberDto&gt; result = queryFactory
                .select(
                        Projections.fields(MemberDto.class,
                                member.username,
                                member.age))
                .from(member)
                .fetch();

        for (MemberDto memberDto : result) {
            System.out.println("memberDto = " + memberDto);
        }
    }

    @DisplayName("QueryDSLì„ ì‚¬ìš©í•˜ì—¬ DTOë¡œ ì¡°íšŒí•˜ê¸° - constructorë¥¼ ì´ìš©í•œ ìƒì„±ì ì ‘ê·¼ ë°©ì‹(DTOì— ëª¨ë“  í•„ë“œ ìƒì„±ì í•„ìš”, ìƒì„±ìë¡œ ìƒì„±í•˜ëŠ” ë°©ì‹)")
    @Test
    void findDtoByConstructor() {
        List&lt;MemberDto&gt; result = queryFactory
                .select(
                        Projections.constructor(MemberDto.class,
                                member.username,
                                member.age))
                .from(member)
                .fetch();

        for (MemberDto memberDto : result) {
            System.out.println("memberDto = " + memberDto);
        }
    }

    @DisplayName("QueryDSLì„ ì‚¬ìš©í•˜ì—¬ DTOë¡œ ì¡°íšŒí•˜ê¸° - QueryProjectionì„ ì‚¬ìš©í•˜ì—¬ DTOë¡œ ì¡°íšŒí•˜ê¸°")
    @Test
    void findDtoByQueryProjection() {
        List&lt;MemberDto&gt; result = queryFactory
                .select(new QMemberDto(member.username, member.age))
                .from(member)
                .fetch();

        for (MemberDto memberDto : result) {
            System.out.println("memberDto = " + memberDto);
        }
    }
    ```
</code></pre></div></div>

<h2 id="memberdtojava">MemberDto.java</h2>

<p>QueryProjectionì„ ì‚¬ìš©í•œ DTO ë§¤í•‘ë°©ì‹ìœ¼ë¡œ ìƒì„±ììœ„ì— @QueryProjectionì´ ìˆì–´ì•¼ í•¨. ì´ë¡œì¨ QueryDSLê³¼ ê²°í•©ë„ê°€ ë†’ì•„ì ¸ë²„ë ¤ì„œ ìˆœìˆ˜í—Œ ê°ì²´ë¡œ ë‚¨ì§€ ì•Šê²Œ ëœëŠ” ë‹¨ì ì´ ìˆë‹¤.<br />
ë‹¤ë¥¸ ë°©ì‹ì€ ì–´ë…¸í…Œì´ì…˜ í•„ìš”ì—†ìŒ. ìƒì„±ìë§Œ ìˆìœ¼ë©´ ë¨.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Data
@NoArgsConstructor
public class MemberDto {
    private String username;
    private int age;

    @QueryProjection
    public MemberDto(String username, int age) {
        this.username = username;
        this.age = age;
    }
}
</code></pre></div></div>

<hr />

<h1 id="5-querydslì„-ì´ìš©í•œ-ë™ì ì¿¼ë¦¬-ë°©ë²•-2ê°€ì§€-ì†Œê°œì™€-ì¶”ì²œí•˜ëŠ”-ë°©ì‹-1">5. QueryDSLì„ ì´ìš©í•œ ë™ì ì¿¼ë¦¬ ë°©ë²• 2ê°€ì§€ ì†Œê°œì™€ ì¶”ì²œí•˜ëŠ” ë°©ì‹</h1>

<p>ë™ì ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì—ëŠ” 2ê°€ì§€ê°€ ìˆë‹¤.</p>

<ol>
  <li>BooleanBuilderë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹</li>
  <li>Where ë‹¤ì¤‘ íŒŒë§ˆë¦¬í„° ë°©ì‹ (BooleanExpression ì‚¬ìš©) [ì¶”ì²œí•˜ëŠ” ë°©ì‹] - ì¡°ê±´ì— nullì„ ë„£ì–´ì„œ ì¡°ê±´ì„ ë¬´ì‹œí•˜ë„ë¡ í•˜ëŠ” ë°©ì‹</li>
</ol>

<h2 id="booleanbuilder-ì‚¬ìš©-ë°©ì‹">BooleanBuilder ì‚¬ìš© ë°©ì‹</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@DisplayName("ë™ì ì¿¼ë¦¬ - BooleanBuilder ì‚¬ìš©í•˜ê¸°")
    @Test
    void dynamicQuery_BooleanBuilder() {
        String usernameParam = "member1";
        Integer ageParam = null;

        List&lt;Member&gt; result = searchMember1(usernameParam, ageParam);
        assertThat(result.size()).isEqualTo(1);
    }

    private List&lt;Member&gt; searchMember1(String usernameCond, Integer ageCond) {
//         BooleanBuilder builder = new BooleanBuilder(member.username.eq(usernameCond));   // usernameì´ nullì´ ì•„ë‹Œ ê²ƒì´ í™•ì‹¤ í•  ë•Œ, ì´ˆê¸°ê°’ìœ¼ë¡œ ë„£ì–´ì¤„ ìˆ˜ ìˆìŒ
        BooleanBuilder builder = new BooleanBuilder();
        if (usernameCond != null) { // usernameì´ nullì´ ì•„ë‹Œ ê²½ìš°
            builder.and(member.username.eq(usernameCond));  // member.username == usernameCond ì¡°ê±´ ì¶”ê°€
        }
        if (ageCond != null) {  // ageê°€ nullì´ ì•„ë‹Œ ê²½ìš°
            builder.and(member.age.eq(ageCond));    // member.age == ageCond ì¡°ê±´ ì¶”ê°€
        }

        return queryFactory
                .selectFrom(member)
                .where(builder)
                .fetch();
    }
</code></pre></div></div>

<h2 id="where-ë‹¤ì¤‘-íŒŒë¼ë©”í„°-ë°©ì‹-booleanexpression-ì‚¬ìš©">Where ë‹¤ì¤‘ íŒŒë¼ë©”í„° ë°©ì‹ (BooleanExpression ì‚¬ìš©)</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    @DisplayName("ë™ì ì¿¼ë¦¬ - Where ë‹¤ì¤‘ íŒŒë¼ë¯¸í„° ì‚¬ìš©í•˜ê¸°")
    @Test
    void dynamicQuery_WhereParam() {
        String usernameParam = "member1";
        Integer ageParam = null;

        List&lt;Member&gt; result = searchMember2(usernameParam, ageParam);
        assertThat(result.size()).isEqualTo(1);
    }

    private List&lt;Member&gt; searchMember2(String usernameCond, Integer ageCond) {
        return queryFactory
                .selectFrom(member)
                .where(usernameEq(usernameCond), ageEq(ageCond))    // usernameEq, ageEq ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì¡°ê±´ì„ ì¶”ê°€, nullì´ ë“¤ì–´ê°€ë©´ ê·¸ ì¡°ê±´ì€ ë¬´ì‹œëœë‹¤.
//                .where(allEq(usernameCond, ageCond))    // ì´ëŸ° ë°©ì‹ìœ¼ë¡œ ì¡°ê±´ì„ í•©ì³ì„œ ë™ì  ì¿¼ë¦¬ë¡œ ì‚¬ìš©í•  ìˆ˜ë„ ìˆë‹¤.
                .fetch();
    }

    private BooleanExpression usernameEq(String usernameCond) {
        return usernameCond != null ? member.username.eq(usernameCond) : null;
    }

    private BooleanExpression ageEq(Integer ageCond) {
        return ageCond != null ? member.age.eq(ageCond) : null;
    }

    private BooleanExpression allEq(String usernameCond, Integer ageCond) {
        return usernameEq(usernameCond).and(ageEq(ageCond));
    }
</code></pre></div></div>

<h1 id="6-í˜ì´ì§•-ì²˜ë¦¬-ë°©ì‹ê³¼-í˜ì´ì§•-ì„±ëŠ¥-ìµœì í™”-ê¸°ë²•-1">6. í˜ì´ì§• ì²˜ë¦¬ ë°©ì‹ê³¼ í˜ì´ì§• ì„±ëŠ¥ ìµœì í™” ê¸°ë²•</h1>

<p>PageableExecutionUtilsë¼ëŠ” SpringFrameWorkì—ì„œ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì´ ìˆë‹¤.<br />
í˜ì´ì§• ì‹œì—ëŠ” ì»¨í…ì¸ ì™€ totalCountì„ êµ¬í•˜ê¸° ìœ„í•´ 2ë²ˆì˜ DBë¥¼ ì¡°íšŒí•˜ê²Œ ë˜ëŠ”ë°,<br />
ì´ PageableExecutionUtilsë¥¼ ì‚¬ìš©í•˜ë©´ totalCountë¥¼ ì¡°íšŒë¥¼ ì•ˆí•´ë„ ë˜ëŠ” ìƒí™©ì´ ìˆë‹¤ë©´ ì¡°íšŒë¥¼ í•˜ì§€ ì•Šì•„ ë°ì´í„°ë² ì´ìŠ¤ ë¶€í•˜ë¥¼ ì¤„ì´ê³ , í˜ì´ì§• ì²˜ë¦¬ ì„±ëŠ¥ì„ ìµœì í™” í•  ìˆ˜ ìˆë‹¤.</p>

<h2 id="ì‚¬ìš©ì-ì •ì˜-ë ˆí¬ì§€í† ë¦¬-êµ¬í˜„ì²´-memberrepositoryimpljava">ì‚¬ìš©ì ì •ì˜ ë ˆí¬ì§€í† ë¦¬ êµ¬í˜„ì²´ (MemberRepositoryImpl.java)</h2>

<p>ì´ ì‚¬ìš©ì ì •ì˜ ë ˆí¬ì§€í† ë¦¬ êµ¬í˜„ì²´ì˜ ë©”ì†Œë“œë¥¼ ë³´ë©´ returnì‹œì— PageableExecutionUtilsë¡œ ìƒì„±í•˜ì—¬ ë¦¬í„´í•˜ì˜€ë‹¤.
ì´ë ‡ê²Œ Pageê°ì²´ë¥¼ ìƒì„±í•˜ë©´ count ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ì§€ì•Šì•„ë„ ë  ë•Œ, ì‚¬ìš©í•˜ì§€ ì•Šì•„ ë°ì´í„°ë² ì´ìŠ¤ ë¶€í•˜ë¥¼ ì¤„ì´ê³ , í˜ì´ì§• ì²˜ë¦¬ ì„±ëŠ¥ì„ ìµœì í™” í•  ìˆ˜ ìˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public class MemberRepositoryImpl implements MemberRepositoryCustom {

    private final JPAQueryFactory queryFactory;

    @Override
    public Page&lt;MemberTeamDto&gt; searchPageComplex(MemberSearchCondition condition, Pageable pageable) {
        List&lt;MemberTeamDto&gt; content = queryFactory
                .select(new QMemberTeamDto(
                        member.id.as("memberId"),
                        member.username,
                        member.age,
                        team.id.as("teamId"),
                        team.name.as("teamName")))
                .from(member)
                .leftJoin(member.team, team)
                .where(
                        usernameEq(condition.getUserName()),
                        teamNameEq(condition.getTeamName()),
                        ageGoe(condition.getAgeGoe()),
                        ageLoe(condition.getAgeLoe())
                )
                .offset(pageable.getOffset())
                .limit(pageable.getPageSize())
                .fetch();

        JPAQuery&lt;Member&gt; countQuery = queryFactory
                .select(member)
                .from(member)
                .leftJoin(member.team, team)
                .where(
                        usernameEq(condition.getUserName()),
                        teamNameEq(condition.getTeamName()),
                        ageGoe(condition.getAgeGoe()),
                        ageLoe(condition.getAgeLoe())
                );

        // í˜ì´ì§• ì„±ëŠ¥ ìµœì í™” ê¸°ë²•, count ì¿¼ë¦¬ê°€ ìƒëµ ê°€ëŠ¥í•œ ê²½ìš° ìƒëµí•´ì„œ ì²˜ë¦¬
//        return PageableExecutionUtils.getPage(content, pageable, () -&gt; countQuery.fetchCount());
        return PageableExecutionUtils.getPage(content, pageable, countQuery::fetchCount);
    }

    private BooleanExpression usernameEq(String username) {
        return hasText(username) ? member.username.eq(username) : null;
    }
    private BooleanExpression teamNameEq(String teamName) {
        return hasText(teamName) ? team.name.eq(teamName) : null;
    }

    private BooleanExpression ageGoe(Integer ageGoe) {
        return ageGoe != null ? member.age.goe(ageGoe) : null;
    }

    private BooleanExpression ageLoe(Integer ageLoe) {
        return ageLoe != null ? member.age.loe(ageLoe) : null;
    }

}
</code></pre></div></div>
</div>
      </div>
    </div>
    
    <div id="disqus" style="padding: 41px"><div id="disqus_thread"></div>
<script>
    /**
    *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
    *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
    
    var disqus_config = function () {
    this.page.url = "https://koreamarin.github.io//backend/2024/07/11/QueryDSL/";  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = 'QueryDSL'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://koreamarin-github-io.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
    
  </div>
</section>

    </div>
    <footer style='background-color: #eefffd;'>
    <address class="footer_wrap">
        <div class="information">
            <div class="myname">
                Jiwon's Blog
            </div>
            <a href="mailto:awldnjs2@gmail.com" class="email">
                awldnjs2@gmail.com
            </a>
            <div class="accounts">
                <span class="icon">
                    <a class="nav-item" target="_blank" href="https://www.github.com/koreamarin/">
                        <i class="fa fa-github"></i>
                    </a>
                </span>
                
                <!--
                    <span class="icon">
                        <a class="nav-item" target="_blank" href="https://www.twitter.com/username/">
                            <i class="fa fa-twitter"></i>
                        </a>
                    </span>
                -->
            </div>
        </div>
        <div class="copyright">
            <span>
                Â© koreamarin. <span id="year">2023</span>
            </span>
        </div>    
    </address>
</footer>
    <script src="/js/script.js"></script>
</body>

</html>